{% extends 'assignments/base.html' %}

{% block title %}Umpire Payments - Umpire Assigner{% endblock %}

{% block content %}
<h2>Umpire Payment Tracking</h2>

<!-- Weekly Payment Summary Grid -->
<div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
    <h3 style="color: white;">Weekly Payment Summary</h3>
    <table class="table" style="color: white;">
        <thead>
            <tr style="border-bottom: 2px solid rgba(255,255,255,0.3);">
                <th style="color: white;">Week</th>
                <th class="text-center" style="color: white;">Games</th>
                <th class="text-center" style="color: white;">Assignments</th>
                <th class="text-center" style="color: white;">Umpires</th>
                <th class="text-right" style="color: white;">Total Payments</th>
                <th class="text-right" style="color: white;">Avg/Game</th>
            </tr>
        </thead>
        <tbody>
            {% for week in weekly_totals %}
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.2);">
                <td style="color: white;">{{ week.week_start|date:"M d" }} - {{ week.week_end|date:"M d, Y" }}</td>
                <td class="text-center" style="color: white;">{{ week.games_count }}</td>
                <td class="text-center" style="color: white;">{{ week.assignments_count }}</td>
                <td class="text-center" style="color: white;">{{ week.umpires_count }}</td>
                <td class="text-right" style="color: white; font-weight: bold;">${{ week.total_amount|floatformat:2 }}</td>
                <td class="text-right" style="color: white;">${{ week.avg_per_game|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center" style="color: white;">No payment data available yet</td>
            </tr>
            {% endfor %}
        </tbody>
        {% if weekly_totals %}
        <tfoot>
            <tr style="border-top: 2px solid rgba(255,255,255,0.3); font-weight: bold;">
                <td style="color: white;">SEASON TOTALS</td>
                <td colspan="3" style="color: white;"></td>
                <td class="text-right" style="color: white; font-size: 1.2rem;">${{ grand_total_owed|floatformat:2 }}</td>
                <td style="color: white;"></td>
            </tr>
        </tfoot>
        {% endif %}
    </table>
</div>

<!-- Grand Totals Summary -->
<div class="card" style="background-color: #f8f9fa;">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
        <div style="text-align: center;">
            <h4 style="color: #495057; margin: 0;">Total Owed</h4>
            <p style="font-size: 2rem; font-weight: bold; color: #2c3e50; margin: 0.5rem 0;">
                ${{ grand_total_owed|floatformat:2 }}
            </p>
        </div>
        <div style="text-align: center;">
            <h4 style="color: #495057; margin: 0;">Total Paid</h4>
            <p style="font-size: 2rem; font-weight: bold; color: #27ae60; margin: 0.5rem 0;">
                ${{ grand_total_paid|floatformat:2 }}
            </p>
        </div>
        <div style="text-align: center;">
            <h4 style="color: #495057; margin: 0;">Outstanding Balance</h4>
            <p style="font-size: 2rem; font-weight: bold; color: #e74c3c; margin: 0.5rem 0;">
                ${{ grand_total_unpaid|floatformat:2 }}
            </p>
        </div>
    </div>
</div>

<div class="card">
    <h3>Individual Umpire Summary</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Umpire</th>
                <th>Status</th>
                <th class="text-right">Total Earned</th>
                <th class="text-right">Total Paid</th>
                <th class="text-right">Balance Due</th>
            </tr>
        </thead>
        <tbody>
            {% for data in umpire_data %}
            <tr>
                <td>
                    {{ data.umpire }}
                    {% if data.umpire.patched %}
                        <span class="badge badge-success">Patched</span>
                    {% endif %}
                    {% if data.umpire.adult %}
                        <span class="badge badge-info">Adult</span>
                    {% endif %}
                </td>
                <td>
                    {% if data.unpaid_amount > 0 %}
                        <span class="badge badge-warning">Payment Due</span>
                    {% else %}
                        <span class="badge badge-success">Current</span>
                    {% endif %}
                </td>
                <td class="text-right">${{ data.total_owed|floatformat:2 }}</td>
                <td class="text-right">${{ data.total_paid|floatformat:2 }}</td>
                <td class="text-right">
                    {% if data.unpaid_amount > 0 %}
                        <strong>${{ data.unpaid_amount|floatformat:2 }}</strong>
                    {% else %}
                        $0.00
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% for data in umpire_data %}
{% if data.unpaid_amount > 0 %}
<div class="card">
    <h3>{{ data.umpire }} - Payment Details</h3>
    
    <div class="mb-3">
        <strong>Balance Due: ${{ data.unpaid_amount|floatformat:2 }}</strong>
    </div>
    
    {% if data.recent_assignments %}
    <h4>Recent Assignments</h4>
    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Game</th>
                <th>Position</th>
                <th class="text-right">Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for assignment in data.recent_assignments %}
            <tr>
                <td>{{ assignment.game.date|date:"M d, Y" }}</td>
                <td>{{ assignment.game }}</td>
                <td>{{ assignment.get_position_display }}</td>
                <td class="text-right">${{ assignment.pay_amount|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    
    {% if data.payment_history %}
    <h4>Payment History</h4>
    <table class="table">
        <thead>
            <tr>
                <th>Period</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Paid Date</th>
            </tr>
        </thead>
        <tbody>
            {% for payment in data.payment_history %}
            <tr>
                <td>{{ payment.period_start|date:"M d" }} - {{ payment.period_end|date:"M d, Y" }}</td>
                <td>${{ payment.amount|floatformat:2 }}</td>
                <td>
                    {% if payment.paid %}
                        <span class="badge badge-success">Paid</span>
                    {% else %}
                        <span class="badge badge-danger">Unpaid</span>
                    {% endif %}
                </td>
                <td>
                    {% if payment.paid_date %}
                        {{ payment.paid_date|date:"M d, Y" }}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>
{% endif %}
{% endfor %}
{% endblock %}